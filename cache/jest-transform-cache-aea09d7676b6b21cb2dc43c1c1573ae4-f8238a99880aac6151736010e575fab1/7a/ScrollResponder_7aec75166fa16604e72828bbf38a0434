a395fa5d4e3e089fee7f596bd97d8e50
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _ScrollViewCommands = _interopRequireDefault(require("./ScrollView/ScrollViewCommands"));

var React = require('react');

var Dimensions = require("../Utilities/Dimensions");

var FrameRateLogger = require("../Interaction/FrameRateLogger");

var Keyboard = require("./Keyboard/Keyboard");

var ReactNative = require("../Renderer/shims/ReactNative");

var TextInputState = require("./TextInput/TextInputState");

var UIManager = require("../ReactNative/UIManager");

var Platform = require("../Utilities/Platform");

var invariant = require('invariant');

var performanceNow = require('fbjs/lib/performanceNow');

var IS_ANIMATING_TOUCH_START_THRESHOLD_MS = 16;
var ScrollResponderMixin = {
  _subscriptionKeyboardWillShow: null,
  _subscriptionKeyboardWillHide: null,
  _subscriptionKeyboardDidShow: null,
  _subscriptionKeyboardDidHide: null,
  scrollResponderMixinGetInitialState: function scrollResponderMixinGetInitialState() {
    return {
      isTouching: false,
      lastMomentumScrollBeginTime: 0,
      lastMomentumScrollEndTime: 0,
      observedScrollSinceBecomingResponder: false,
      becameResponderWhileAnimating: false
    };
  },
  scrollResponderHandleScrollShouldSetResponder: function scrollResponderHandleScrollShouldSetResponder() {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    return this.state.isTouching;
  },
  scrollResponderHandleStartShouldSetResponder: function scrollResponderHandleStartShouldSetResponder(e) {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();

    if (this.props.keyboardShouldPersistTaps === 'handled' && currentlyFocusedTextInput != null && ReactNative.findNodeHandle(e.target) !== currentlyFocusedTextInput) {
      return true;
    }

    return false;
  },
  scrollResponderHandleStartShouldSetResponderCapture: function scrollResponderHandleStartShouldSetResponderCapture(e) {
    if (this.scrollResponderIsAnimating()) {
      return true;
    }

    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();
    var keyboardShouldPersistTaps = this.props.keyboardShouldPersistTaps;
    var keyboardNeverPersistTaps = !keyboardShouldPersistTaps || keyboardShouldPersistTaps === 'never';
    var reactTag = ReactNative.findNodeHandle(e.target);

    if (keyboardNeverPersistTaps && currentlyFocusedTextInput != null && reactTag && !TextInputState.isTextInput(reactTag)) {
      return true;
    }

    return false;
  },
  scrollResponderHandleResponderReject: function scrollResponderHandleResponderReject() {},
  scrollResponderHandleTerminationRequest: function scrollResponderHandleTerminationRequest() {
    return !this.state.observedScrollSinceBecomingResponder;
  },
  scrollResponderHandleTouchEnd: function scrollResponderHandleTouchEnd(e) {
    var nativeEvent = e.nativeEvent;
    this.state.isTouching = nativeEvent.touches.length !== 0;
    this.props.onTouchEnd && this.props.onTouchEnd(e);
  },
  scrollResponderHandleTouchCancel: function scrollResponderHandleTouchCancel(e) {
    this.state.isTouching = false;
    this.props.onTouchCancel && this.props.onTouchCancel(e);
  },
  scrollResponderHandleResponderRelease: function scrollResponderHandleResponderRelease(e) {
    this.props.onResponderRelease && this.props.onResponderRelease(e);
    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();

    if (this.props.keyboardShouldPersistTaps !== true && this.props.keyboardShouldPersistTaps !== 'always' && currentlyFocusedTextInput != null && ReactNative.findNodeHandle(e.target) !== currentlyFocusedTextInput && !this.state.observedScrollSinceBecomingResponder && !this.state.becameResponderWhileAnimating) {
      this.props.onScrollResponderKeyboardDismissed && this.props.onScrollResponderKeyboardDismissed(e);
      TextInputState.blurTextInput(currentlyFocusedTextInput);
    }
  },
  scrollResponderHandleScroll: function scrollResponderHandleScroll(e) {
    this.state.observedScrollSinceBecomingResponder = true;
    this.props.onScroll && this.props.onScroll(e);
  },
  scrollResponderHandleResponderGrant: function scrollResponderHandleResponderGrant(e) {
    this.state.observedScrollSinceBecomingResponder = false;
    this.props.onResponderGrant && this.props.onResponderGrant(e);
    this.state.becameResponderWhileAnimating = this.scrollResponderIsAnimating();
  },
  scrollResponderHandleScrollBeginDrag: function scrollResponderHandleScrollBeginDrag(e) {
    FrameRateLogger.beginScroll();
    this.props.onScrollBeginDrag && this.props.onScrollBeginDrag(e);
  },
  scrollResponderHandleScrollEndDrag: function scrollResponderHandleScrollEndDrag(e) {
    var velocity = e.nativeEvent.velocity;

    if (!this.scrollResponderIsAnimating() && (!velocity || velocity.x === 0 && velocity.y === 0)) {
      FrameRateLogger.endScroll();
    }

    this.props.onScrollEndDrag && this.props.onScrollEndDrag(e);
  },
  scrollResponderHandleMomentumScrollBegin: function scrollResponderHandleMomentumScrollBegin(e) {
    this.state.lastMomentumScrollBeginTime = performanceNow();
    this.props.onMomentumScrollBegin && this.props.onMomentumScrollBegin(e);
  },
  scrollResponderHandleMomentumScrollEnd: function scrollResponderHandleMomentumScrollEnd(e) {
    FrameRateLogger.endScroll();
    this.state.lastMomentumScrollEndTime = performanceNow();
    this.props.onMomentumScrollEnd && this.props.onMomentumScrollEnd(e);
  },
  scrollResponderHandleTouchStart: function scrollResponderHandleTouchStart(e) {
    this.state.isTouching = true;
    this.props.onTouchStart && this.props.onTouchStart(e);
  },
  scrollResponderHandleTouchMove: function scrollResponderHandleTouchMove(e) {
    this.props.onTouchMove && this.props.onTouchMove(e);
  },
  scrollResponderIsAnimating: function scrollResponderIsAnimating() {
    var now = performanceNow();
    var timeSinceLastMomentumScrollEnd = now - this.state.lastMomentumScrollEndTime;
    var isAnimating = timeSinceLastMomentumScrollEnd < IS_ANIMATING_TOUCH_START_THRESHOLD_MS || this.state.lastMomentumScrollEndTime < this.state.lastMomentumScrollBeginTime;
    return isAnimating;
  },
  scrollResponderGetScrollableNode: function scrollResponderGetScrollableNode() {
    return this.getScrollableNode ? this.getScrollableNode() : ReactNative.findNodeHandle(this);
  },
  scrollResponderScrollTo: function scrollResponderScrollTo(x, y, animated) {
    if (typeof x === 'number') {
      console.warn('`scrollResponderScrollTo(x, y, animated)` is deprecated. Use `scrollResponderScrollTo({x: 5, y: 5, animated: true})` instead.');
    } else {
      var _ref = x || {};

      x = _ref.x;
      y = _ref.y;
      animated = _ref.animated;
    }

    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected scrollTo to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.scrollTo(nativeScrollRef, x || 0, y || 0, animated !== false);
  },
  scrollResponderScrollToEnd: function scrollResponderScrollToEnd(options) {
    var animated = (options && options.animated) !== false;
    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected scrollToEnd to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.scrollToEnd(nativeScrollRef, animated);
  },
  scrollResponderZoomTo: function scrollResponderZoomTo(rect, animated) {
    invariant(Platform.OS === 'ios', 'zoomToRect is not implemented');

    if ('animated' in rect) {
      animated = rect.animated;
      delete rect.animated;
    } else if (typeof animated !== 'undefined') {
      console.warn('`scrollResponderZoomTo` `animated` argument is deprecated. Use `options.animated` instead');
    }

    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected zoomToRect to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.zoomToRect(nativeScrollRef, rect, animated !== false);
  },
  scrollResponderFlashScrollIndicators: function scrollResponderFlashScrollIndicators() {
    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected flashScrollIndicators to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.flashScrollIndicators(nativeScrollRef);
  },
  scrollResponderScrollNativeHandleToKeyboard: function scrollResponderScrollNativeHandleToKeyboard(nodeHandle, additionalOffset, preventNegativeScrollOffset) {
    this.additionalScrollOffset = additionalOffset || 0;
    this.preventNegativeScrollOffset = !!preventNegativeScrollOffset;

    if (typeof nodeHandle === 'number') {
      UIManager.measureLayout(nodeHandle, ReactNative.findNodeHandle(this.getInnerViewNode()), this.scrollResponderTextInputFocusError, this.scrollResponderInputMeasureAndScrollToKeyboard);
    } else {
      var innerRef = this.getInnerViewRef();

      if (innerRef == null) {
        return;
      }

      nodeHandle.measureLayout(innerRef, this.scrollResponderInputMeasureAndScrollToKeyboard, this.scrollResponderTextInputFocusError);
    }
  },
  scrollResponderInputMeasureAndScrollToKeyboard: function scrollResponderInputMeasureAndScrollToKeyboard(left, top, width, height) {
    var keyboardScreenY = Dimensions.get('window').height;

    if (this.keyboardWillOpenTo) {
      keyboardScreenY = this.keyboardWillOpenTo.endCoordinates.screenY;
    }

    var scrollOffsetY = top - keyboardScreenY + height + this.additionalScrollOffset;

    if (this.preventNegativeScrollOffset) {
      scrollOffsetY = Math.max(0, scrollOffsetY);
    }

    this.scrollResponderScrollTo({
      x: 0,
      y: scrollOffsetY,
      animated: true
    });
    this.additionalOffset = 0;
    this.preventNegativeScrollOffset = false;
  },
  scrollResponderTextInputFocusError: function scrollResponderTextInputFocusError(msg) {
    console.error('Error measuring text field: ', msg);
  },
  UNSAFE_componentWillMount: function UNSAFE_componentWillMount() {
    var _ref2 = this.props,
        keyboardShouldPersistTaps = _ref2.keyboardShouldPersistTaps;

    if (typeof keyboardShouldPersistTaps === 'boolean') {
      console.warn("'keyboardShouldPersistTaps={" + (keyboardShouldPersistTaps === true ? 'true' : 'false') + "}' is deprecated. " + ("Use 'keyboardShouldPersistTaps=\"" + (keyboardShouldPersistTaps ? 'always' : 'never') + "\"' instead"));
    }

    this.keyboardWillOpenTo = null;
    this.additionalScrollOffset = 0;
    this._subscriptionKeyboardWillShow = Keyboard.addListener('keyboardWillShow', this.scrollResponderKeyboardWillShow);
    this._subscriptionKeyboardWillHide = Keyboard.addListener('keyboardWillHide', this.scrollResponderKeyboardWillHide);
    this._subscriptionKeyboardDidShow = Keyboard.addListener('keyboardDidShow', this.scrollResponderKeyboardDidShow);
    this._subscriptionKeyboardDidHide = Keyboard.addListener('keyboardDidHide', this.scrollResponderKeyboardDidHide);
  },
  componentWillUnmount: function componentWillUnmount() {
    if (this._subscriptionKeyboardWillShow != null) {
      this._subscriptionKeyboardWillShow.remove();
    }

    if (this._subscriptionKeyboardWillHide != null) {
      this._subscriptionKeyboardWillHide.remove();
    }

    if (this._subscriptionKeyboardDidShow != null) {
      this._subscriptionKeyboardDidShow.remove();
    }

    if (this._subscriptionKeyboardDidHide != null) {
      this._subscriptionKeyboardDidHide.remove();
    }
  },
  scrollResponderKeyboardWillShow: function scrollResponderKeyboardWillShow(e) {
    this.keyboardWillOpenTo = e;
    this.props.onKeyboardWillShow && this.props.onKeyboardWillShow(e);
  },
  scrollResponderKeyboardWillHide: function scrollResponderKeyboardWillHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardWillHide && this.props.onKeyboardWillHide(e);
  },
  scrollResponderKeyboardDidShow: function scrollResponderKeyboardDidShow(e) {
    if (e) {
      this.keyboardWillOpenTo = e;
    }

    this.props.onKeyboardDidShow && this.props.onKeyboardDidShow(e);
  },
  scrollResponderKeyboardDidHide: function scrollResponderKeyboardDidHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardDidHide && this.props.onKeyboardDidHide(e);
  }
};
var ScrollResponder = {
  Mixin: ScrollResponderMixin
};
module.exports = ScrollResponder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcm9sbFJlc3BvbmRlci5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsInJlcXVpcmUiLCJEaW1lbnNpb25zIiwiRnJhbWVSYXRlTG9nZ2VyIiwiS2V5Ym9hcmQiLCJSZWFjdE5hdGl2ZSIsIlRleHRJbnB1dFN0YXRlIiwiVUlNYW5hZ2VyIiwiUGxhdGZvcm0iLCJpbnZhcmlhbnQiLCJwZXJmb3JtYW5jZU5vdyIsIklTX0FOSU1BVElOR19UT1VDSF9TVEFSVF9USFJFU0hPTERfTVMiLCJTY3JvbGxSZXNwb25kZXJNaXhpbiIsIl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUiLCJfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZSIsInNjcm9sbFJlc3BvbmRlck1peGluR2V0SW5pdGlhbFN0YXRlIiwiaXNUb3VjaGluZyIsImxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSIsImxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUiLCJvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIiLCJiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlciIsInByb3BzIiwiZGlzYWJsZVNjcm9sbFZpZXdQYW5SZXNwb25kZXIiLCJzdGF0ZSIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyIiwiZSIsImN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQiLCJjdXJyZW50bHlGb2N1c2VkRmllbGQiLCJrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzIiwiZmluZE5vZGVIYW5kbGUiLCJ0YXJnZXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJzY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZyIsImtleWJvYXJkTmV2ZXJQZXJzaXN0VGFwcyIsInJlYWN0VGFnIiwiaXNUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWplY3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUZXJtaW5hdGlvblJlcXVlc3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaEVuZCIsIm5hdGl2ZUV2ZW50IiwidG91Y2hlcyIsImxlbmd0aCIsIm9uVG91Y2hFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaENhbmNlbCIsIm9uVG91Y2hDYW5jZWwiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWxlYXNlIiwib25SZXNwb25kZXJSZWxlYXNlIiwib25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZCIsImJsdXJUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGwiLCJvblNjcm9sbCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlckdyYW50Iiwib25SZXNwb25kZXJHcmFudCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbEJlZ2luRHJhZyIsImJlZ2luU2Nyb2xsIiwib25TY3JvbGxCZWdpbkRyYWciLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxFbmREcmFnIiwidmVsb2NpdHkiLCJ4IiwieSIsImVuZFNjcm9sbCIsIm9uU2Nyb2xsRW5kRHJhZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsQmVnaW4iLCJvbk1vbWVudHVtU2Nyb2xsQmVnaW4iLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVNb21lbnR1bVNjcm9sbEVuZCIsIm9uTW9tZW50dW1TY3JvbGxFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaFN0YXJ0Iiwib25Ub3VjaFN0YXJ0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hNb3ZlIiwib25Ub3VjaE1vdmUiLCJub3ciLCJ0aW1lU2luY2VMYXN0TW9tZW50dW1TY3JvbGxFbmQiLCJpc0FuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlIiwiZ2V0U2Nyb2xsYWJsZU5vZGUiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyIsImFuaW1hdGVkIiwiY29uc29sZSIsIndhcm4iLCJ0aGF0IiwiZ2V0TmF0aXZlU2Nyb2xsUmVmIiwibmF0aXZlU2Nyb2xsUmVmIiwiQ29tbWFuZHMiLCJzY3JvbGxUbyIsInNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kIiwib3B0aW9ucyIsInNjcm9sbFRvRW5kIiwic2Nyb2xsUmVzcG9uZGVyWm9vbVRvIiwicmVjdCIsIk9TIiwiem9vbVRvUmVjdCIsInNjcm9sbFJlc3BvbmRlckZsYXNoU2Nyb2xsSW5kaWNhdG9ycyIsImZsYXNoU2Nyb2xsSW5kaWNhdG9ycyIsInNjcm9sbFJlc3BvbmRlclNjcm9sbE5hdGl2ZUhhbmRsZVRvS2V5Ym9hcmQiLCJub2RlSGFuZGxlIiwiYWRkaXRpb25hbE9mZnNldCIsInByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldCIsImFkZGl0aW9uYWxTY3JvbGxPZmZzZXQiLCJtZWFzdXJlTGF5b3V0IiwiZ2V0SW5uZXJWaWV3Tm9kZSIsInNjcm9sbFJlc3BvbmRlclRleHRJbnB1dEZvY3VzRXJyb3IiLCJzY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkIiwiaW5uZXJSZWYiLCJnZXRJbm5lclZpZXdSZWYiLCJsZWZ0IiwidG9wIiwid2lkdGgiLCJoZWlnaHQiLCJrZXlib2FyZFNjcmVlblkiLCJnZXQiLCJrZXlib2FyZFdpbGxPcGVuVG8iLCJlbmRDb29yZGluYXRlcyIsInNjcmVlblkiLCJzY3JvbGxPZmZzZXRZIiwiTWF0aCIsIm1heCIsIm1zZyIsImVycm9yIiwiVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCIsImFkZExpc3RlbmVyIiwic2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdyIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbEhpZGUiLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZFNob3ciLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZEhpZGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZSIsIm9uS2V5Ym9hcmRXaWxsU2hvdyIsIm9uS2V5Ym9hcmRXaWxsSGlkZSIsIm9uS2V5Ym9hcmREaWRTaG93Iiwib25LZXlib2FyZERpZEhpZGUiLCJTY3JvbGxSZXNwb25kZXIiLCJNaXhpbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOzs7O0FBVUE7O0FBUkEsSUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxJQUFNQyxVQUFVLEdBQUdELE9BQU8sMkJBQTFCOztBQUNBLElBQU1FLGVBQWUsR0FBR0YsT0FBTyxrQ0FBL0I7O0FBQ0EsSUFBTUcsUUFBUSxHQUFHSCxPQUFPLHVCQUF4Qjs7QUFDQSxJQUFNSSxXQUFXLEdBQUdKLE9BQU8saUNBQTNCOztBQUNBLElBQU1LLGNBQWMsR0FBR0wsT0FBTyw4QkFBOUI7O0FBQ0EsSUFBTU0sU0FBUyxHQUFHTixPQUFPLDRCQUF6Qjs7QUFDQSxJQUFNTyxRQUFRLEdBQUdQLE9BQU8seUJBQXhCOztBQUdBLElBQU1RLFNBQVMsR0FBR1IsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBQ0EsSUFBTVMsY0FBYyxHQUFHVCxPQUFPLENBQUMseUJBQUQsQ0FBOUI7O0FBdUZBLElBQU1VLHFDQUFxQyxHQUFHLEVBQTlDO0FBVUEsSUFBTUMsb0JBQW9CLEdBQUc7QUFDM0JDLEVBQUFBLDZCQUE2QixFQUFHLElBREw7QUFFM0JDLEVBQUFBLDZCQUE2QixFQUFHLElBRkw7QUFHM0JDLEVBQUFBLDRCQUE0QixFQUFHLElBSEo7QUFJM0JDLEVBQUFBLDRCQUE0QixFQUFHLElBSko7QUFLM0JDLEVBQUFBLG1DQUFtQyxFQUFFLCtDQUFrQjtBQUNyRCxXQUFPO0FBQ0xDLE1BQUFBLFVBQVUsRUFBRSxLQURQO0FBRUxDLE1BQUFBLDJCQUEyQixFQUFFLENBRnhCO0FB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QUUsd0NBQVNsRyxDQUFULEVBQTJCO0FBQ3pELFNBQUtxRixrQkFBTCxHQUEwQixJQUExQjtBQUNBLFNBQUt6RixLQUFMLENBQVc0RyxpQkFBWCxJQUFnQyxLQUFLNUcsS0FBTCxDQUFXNEcsaUJBQVgsQ0FBNkJ4RyxDQUE3QixDQUFoQztBQUNEO0FBcm5CMEIsQ0FBN0I7QUF3bkJBLElBQU15RyxlQUFlLEdBQUc7QUFDdEJDLEVBQUFBLEtBQUssRUFBRTFIO0FBRGUsQ0FBeEI7QUFJQTJILE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQkgsZUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmb3JtYXRcbiAqIEBmbG93XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBEaW1lbnNpb25zID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL0RpbWVuc2lvbnMnKTtcbmNvbnN0IEZyYW1lUmF0ZUxvZ2dlciA9IHJlcXVpcmUoJy4uL0ludGVyYWN0aW9uL0ZyYW1lUmF0ZUxvZ2dlcicpO1xuY29uc3QgS2V5Ym9hcmQgPSByZXF1aXJlKCcuL0tleWJvYXJkL0tleWJvYXJkJyk7XG5jb25zdCBSZWFjdE5hdGl2ZSA9IHJlcXVpcmUoJy4uL1JlbmRlcmVyL3NoaW1zL1JlYWN0TmF0aXZlJyk7XG5jb25zdCBUZXh0SW5wdXRTdGF0ZSA9IHJlcXVpcmUoJy4vVGV4dElucHV0L1RleHRJbnB1dFN0YXRlJyk7XG5jb25zdCBVSU1hbmFnZXIgPSByZXF1aXJlKCcuLi9SZWFjdE5hdGl2ZS9VSU1hbmFnZXInKTtcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL1BsYXRmb3JtJyk7XG5pbXBvcnQgQ29tbWFuZHMgZnJvbSAnLi9TY3JvbGxWaWV3L1Njcm9sbFZpZXdDb21tYW5kcyc7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuY29uc3QgcGVyZm9ybWFuY2VOb3cgPSByZXF1aXJlKCdmYmpzL2xpYi9wZXJmb3JtYW5jZU5vdycpO1xuXG5pbXBvcnQgdHlwZSB7UHJlc3NFdmVudCwgU2Nyb2xsRXZlbnR9IGZyb20gJy4uL1R5cGVzL0NvcmVFdmVudFR5cGVzJztcbmltcG9ydCB0eXBlb2YgU2Nyb2xsVmlldyBmcm9tICcuL1Njcm9sbFZpZXcvU2Nyb2xsVmlldyc7XG5pbXBvcnQgdHlwZSB7UHJvcHMgYXMgU2Nyb2xsVmlld1Byb3BzfSBmcm9tICcuL1Njcm9sbFZpZXcvU2Nyb2xsVmlldyc7XG5pbXBvcnQgdHlwZSB7S2V5Ym9hcmRFdmVudH0gZnJvbSAnLi9LZXlib2FyZC9LZXlib2FyZCc7XG5pbXBvcnQgdHlwZSBFbWl0dGVyU3Vic2NyaXB0aW9uIGZyb20gJy4uL3ZlbmRvci9lbWl0dGVyL0VtaXR0ZXJTdWJzY3JpcHRpb24nO1xuaW1wb3J0IHR5cGUge0hvc3RDb21wb25lbnR9IGZyb20gJy4uL1JlbmRlcmVyL3NoaW1zL1JlYWN0TmF0aXZlVHlwZXMnO1xuXG4vKipcbiAqIE1peGluIHRoYXQgY2FuIGJlIGludGVncmF0ZWQgaW4gb3JkZXIgdG8gaGFuZGxlIHNjcm9sbGluZyB0aGF0IHBsYXlzIHdlbGxcbiAqIHdpdGggYFJlc3BvbmRlckV2ZW50UGx1Z2luYC4gSW50ZWdyYXRlIHdpdGggeW91ciBwbGF0Zm9ybSBzcGVjaWZpYyBzY3JvbGxcbiAqIHZpZXdzLCBvciBldmVuIHlvdXIgY3VzdG9tIGJ1aWx0IChldmVyeS1mcmFtZSBhbmltYXRpbmcpIHNjcm9sbCB2aWV3cyBzbyB0aGF0XG4gKiBhbGwgb2YgdGhlc2Ugc3lzdGVtcyBwbGF5IHdlbGwgd2l0aCB0aGUgYFJlc3BvbmRlckV2ZW50UGx1Z2luYC5cbiAqXG4gKiBpT1Mgc2Nyb2xsIGV2ZW50IHRpbWluZyBudWFuY2VzOlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICpcbiAqXG4gKiBTY3JvbGxpbmcgd2l0aG91dCBib3VuY2luZywgaWYgeW91IHRvdWNoIGRvd246XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKlxuICogMS4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKHdoZW4gYW5pbWF0aW9uIGJlZ2lucyBhZnRlciBsZXR0aW5nIHVwKVxuICogICAgLi4uIHBoeXNpY2FsIHRvdWNoIHN0YXJ0cyAuLi5cbiAqIDIuIGBvblRvdWNoU3RhcnRDYXB0dXJlYCAgICh3aGVuIHlvdSBwcmVzcyBkb3duIHRvIHN0b3AgdGhlIHNjcm9sbClcbiAqIDMuIGBvblRvdWNoU3RhcnRgICAgICAgICAgIChzYW1lLCBidXQgYnViYmxlIHBoYXNlKVxuICogNC4gYG9uUmVzcG9uZGVyUmVsZWFzZWAgICAgKHdoZW4gbGlmdGluZyB1cCAtIHlvdSBjb3VsZCBwYXVzZSBmb3JldmVyIGJlZm9yZSAqIGxpZnRpbmcpXG4gKiA1LiBgb25Nb21lbnR1bVNjcm9sbEVuZGBcbiAqXG4gKlxuICogU2Nyb2xsaW5nIHdpdGggYm91bmNpbmcsIGlmIHlvdSB0b3VjaCBkb3duOlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICpcbiAqIDEuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gICh3aGVuIGFuaW1hdGlvbiBiZWdpbnMgYWZ0ZXIgbGV0dGluZyB1cClcbiAqICAgIC4uLiBib3VuY2UgYmVnaW5zIC4uLlxuICogICAgLi4uIHNvbWUgdGltZSBlbGFwc2VzIC4uLlxuICogICAgLi4uIHBoeXNpY2FsIHRvdWNoIGR1cmluZyBib3VuY2UgLi4uXG4gKiAyLiBgb25Nb21lbnR1bVNjcm9sbEVuZGAgICAoTWFrZXMgbm8gc2Vuc2Ugd2h5IHRoaXMgb2NjdXJzIGZpcnN0IGR1cmluZyBib3VuY2UpXG4gKiAzLiBgb25Ub3VjaFN0YXJ0Q2FwdHVyZWAgICAoaW1tZWRpYXRlbHkgYWZ0ZXIgYG9uTW9tZW50dW1TY3JvbGxFbmRgKVxuICogNC4gYG9uVG91Y2hTdGFydGAgICAgICAgICAgKHNhbWUsIGJ1dCBidWJibGUgcGhhc2UpXG4gKiA1LiBgb25Ub3VjaEVuZGAgICAgICAgICAgICAoWW91IGNvdWxkIGhvbGQgdGhlIHRvdWNoIHN0YXJ0IGZvciBhIGxvbmcgdGltZSlcbiAqIDYuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gIChXaGVuIHJlbGVhc2luZyB0aGUgdmlldyBzdGFydHMgYm91bmNpbmcgYmFjaylcbiAqXG4gKiBTbyB3aGVuIHdlIHJlY2VpdmUgYW4gYG9uVG91Y2hTdGFydGAsIGhvdyBjYW4gd2UgdGVsbCBpZiB3ZSBhcmUgdG91Y2hpbmdcbiAqICpkdXJpbmcqIGFuIGFuaW1hdGlvbiAod2hpY2ggdGhlbiBjYXVzZXMgdGhlIGFuaW1hdGlvbiB0byBzdG9wKT8gVGhlIG9ubHkgd2F5XG4gKiB0byB0ZWxsIGlzIGlmIHRoZSBgdG91Y2hTdGFydGAgb2NjdXJyZWQgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlXG4gKiBgb25Nb21lbnR1bVNjcm9sbEVuZGAuXG4gKlxuICogVGhpcyBpcyBhYnN0cmFjdGVkIG91dCBmb3IgeW91LCBzbyB5b3UgY2FuIGp1c3QgY2FsbCB0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkgaWZcbiAqIG5lY2Vzc2FyeVxuICpcbiAqIGBTY3JvbGxSZXNwb25kZXJgIGFsc28gaW5jbHVkZXMgbG9naWMgZm9yIGJsdXJyaW5nIGEgY3VycmVudGx5IGZvY3VzZWQgaW5wdXRcbiAqIGlmIG9uZSBpcyBmb2N1c2VkIHdoaWxlIHNjcm9sbGluZy4gVGhlIGBTY3JvbGxSZXNwb25kZXJgIGlzIGEgbmF0dXJhbCBwbGFjZVxuICogdG8gcHV0IHRoaXMgbG9naWMgc2luY2UgaXQgY2FuIHN1cHBvcnQgbm90IGRpc21pc3NpbmcgdGhlIGtleWJvYXJkIHdoaWxlXG4gKiBzY3JvbGxpbmcsIHVubGVzcyBhIHJlY29nbml6ZWQgXCJ0YXBcIi1saWtlIGdlc3R1cmUgaGFzIG9jY3VycmVkLlxuICpcbiAqIFRoZSBwdWJsaWMgbGlmZWN5Y2xlIEFQSSBpbmNsdWRlcyBldmVudHMgZm9yIGtleWJvYXJkIGludGVyYWN0aW9uLCByZXNwb25kZXJcbiAqIGludGVyYWN0aW9uLCBhbmQgc2Nyb2xsaW5nIChhbW9uZyBvdGhlcnMpLiBUaGUga2V5Ym9hcmQgY2FsbGJhY2tzXG4gKiBgb25LZXlib2FyZFdpbGwvRGlkLypgIGFyZSAqZ2xvYmFsKiBldmVudHMsIGJ1dCBhcmUgaW52b2tlZCBvbiBzY3JvbGxcbiAqIHJlc3BvbmRlcidzIHByb3BzIHNvIHRoYXQgeW91IGNhbiBndWFyYW50ZWUgdGhhdCB0aGUgc2Nyb2xsIHJlc3BvbmRlcidzXG4gKiBpbnRlcm5hbCBzdGF0ZSBoYXMgYmVlbiB1cGRhdGVkIGFjY29yZGluZ2x5IChhbmQgZGV0ZXJtaW5pc3RpY2FsbHkpIGJ5XG4gKiB0aGUgdGltZSB0aGUgcHJvcHMgY2FsbGJhY2tzIGFyZSBpbnZva2UuIE90aGVyd2lzZSwgeW91IHdvdWxkIGFsd2F5cyB3b25kZXJcbiAqIGlmIHRoZSBzY3JvbGwgcmVzcG9uZGVyIGlzIGN1cnJlbnRseSBpbiBhIHN0YXRlIHdoZXJlIGl0IHJlY29nbml6ZXMgbmV3XG4gKiBrZXlib2FyZCBwb3NpdGlvbnMgZXRjLiBJZiBjb29yZGluYXRpbmcgc2Nyb2xsaW5nIHdpdGgga2V5Ym9hcmQgbW92ZW1lbnQsXG4gKiAqYWx3YXlzKiB1c2UgdGhlc2UgaG9va3MgaW5zdGVhZCBvZiBsaXN0ZW5pbmcgdG8geW91ciBvd24gZ2xvYmFsIGtleWJvYXJkXG4gKiBldmVudHMuXG4gKlxuICogUHVibGljIGtleWJvYXJkIGxpZmVjeWNsZSBBUEk6IChwcm9wcyBjYWxsYmFja3MpXG4gKlxuICogU3RhbmRhcmQgS2V5Ym9hcmQgQXBwZWFyYW5jZSBTZXF1ZW5jZTpcbiAqXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxTaG93XG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZFNob3dcbiAqXG4gKiBgb25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZGAgd2lsbCBiZSBpbnZva2VkIGlmIGFuIGFwcHJvcHJpYXRlXG4gKiB0YXAgaW5zaWRlIHRoZSBzY3JvbGwgcmVzcG9uZGVyJ3Mgc2Nyb2xsYWJsZSByZWdpb24gd2FzIHJlc3BvbnNpYmxlXG4gKiBmb3IgdGhlIGRpc21pc3NhbCBvZiB0aGUga2V5Ym9hcmQuIFRoZXJlIGFyZSBvdGhlciByZWFzb25zIHdoeSB0aGVcbiAqIGtleWJvYXJkIGNvdWxkIGJlIGRpc21pc3NlZC5cbiAqXG4gKiAgIHRoaXMucHJvcHMub25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZFxuICpcbiAqIFN0YW5kYXJkIEtleWJvYXJkIEhpZGUgU2VxdWVuY2U6XG4gKlxuICogICB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsSGlkZVxuICogICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRIaWRlXG4gKi9cblxuY29uc3QgSVNfQU5JTUFUSU5HX1RPVUNIX1NUQVJUX1RIUkVTSE9MRF9NUyA9IDE2O1xuXG5leHBvcnQgdHlwZSBTdGF0ZSA9IHt8XG4gIGlzVG91Y2hpbmc6IGJvb2xlYW4sXG4gIGxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTogbnVtYmVyLFxuICBsYXN0TW9tZW50dW1TY3JvbGxFbmRUaW1lOiBudW1iZXIsXG4gIG9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlcjogYm9vbGVhbixcbiAgYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmc6IGJvb2xlYW4sXG58fTtcblxuY29uc3QgU2Nyb2xsUmVzcG9uZGVyTWl4aW4gPSB7XG4gIF9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93OiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBfc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZTogKG51bGw6ID9FbWl0dGVyU3Vic2NyaXB0aW9uKSxcbiAgX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkU2hvdzogKG51bGw6ID9FbWl0dGVyU3Vic2NyaXB0aW9uKSxcbiAgX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZTogKG51bGw6ID9FbWl0dGVyU3Vic2NyaXB0aW9uKSxcbiAgc2Nyb2xsUmVzcG9uZGVyTWl4aW5HZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCk6IFN0YXRlIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNUb3VjaGluZzogZmFsc2UsXG4gICAgICBsYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWU6IDAsXG4gICAgICBsYXN0TW9tZW50dW1TY3JvbGxFbmRUaW1lOiAwLFxuXG4gICAgICAvLyBSZXNldCB0byBmYWxzZSBldmVyeSB0aW1lIGJlY29tZXMgcmVzcG9uZGVyLiBUaGlzIGlzIHVzZWQgdG86XG4gICAgICAvLyAtIERldGVybWluZSBpZiB0aGUgc2Nyb2xsIHZpZXcgaGFzIGJlZW4gc2Nyb2xsZWQgYW5kIHRoZXJlZm9yZSBzaG91bGRcbiAgICAgIC8vIHJlZnVzZSB0byBnaXZlIHVwIGl0cyByZXNwb25kZXIgbG9jay5cbiAgICAgIC8vIC0gRGV0ZXJtaW5lIGlmIHJlbGVhc2luZyBzaG91bGQgZGlzbWlzcyB0aGUga2V5Ym9hcmQgd2hlbiB3ZSBhcmUgaW5cbiAgICAgIC8vIHRhcC10by1kaXNtaXNzIG1vZGUgKHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyAhPT0gJ2Fsd2F5cycpLlxuICAgICAgb2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyOiBmYWxzZSxcbiAgICAgIGJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nOiBmYWxzZSxcbiAgICB9O1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblNjcm9sbGAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxTaG91bGRTZXRSZXNwb25kZXI6IGZ1bmN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIC8vIEFsbG93IGFueSBldmVudCB0b3VjaCBwYXNzIHRocm91Z2ggaWYgdGhlIGRlZmF1bHQgcGFuIHJlc3BvbmRlciBpcyBkaXNhYmxlZFxuICAgIGlmICh0aGlzLnByb3BzLmRpc2FibGVTY3JvbGxWaWV3UGFuUmVzcG9uZGVyID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnN0YXRlLmlzVG91Y2hpbmc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIE1lcmVseSB0b3VjaCBzdGFydGluZyBpcyBub3Qgc3VmZmljaWVudCBmb3IgYSBzY3JvbGwgdmlldyB0byBiZWNvbWUgdGhlXG4gICAqIHJlc3BvbmRlci4gQmVpbmcgdGhlIFwicmVzcG9uZGVyXCIgbWVhbnMgdGhhdCB0aGUgdmVyeSBuZXh0IHRvdWNoIG1vdmUvZW5kXG4gICAqIGV2ZW50IHdpbGwgcmVzdWx0IGluIGFuIGFjdGlvbi9tb3ZlbWVudC5cbiAgICpcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcmAgZXZlbnQuXG4gICAqXG4gICAqIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYCBpcyB1c2VkIHdoZW4gdGhlIG5leHQgbW92ZS9lbmQgd2lsbCB0cmlnZ2VyXG4gICAqIHNvbWUgVUkgbW92ZW1lbnQvYWN0aW9uLCBidXQgd2hlbiB5b3Ugd2FudCB0byB5aWVsZCBwcmlvcml0eSB0byB2aWV3c1xuICAgKiBuZXN0ZWQgaW5zaWRlIG9mIHRoZSB2aWV3LlxuICAgKlxuICAgKiBUaGVyZSBtYXkgYmUgc29tZSBjYXNlcyB3aGVyZSBzY3JvbGwgdmlld3MgYWN0dWFsbHkgc2hvdWxkIHJldHVybiBgdHJ1ZWBcbiAgICogZnJvbSBgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcmA6IEFueSB0aW1lIHdlIGFyZSBkZXRlY3RpbmcgYSBzdGFuZGFyZCB0YXBcbiAgICogdGhhdCBnaXZlcyBwcmlvcml0eSB0byBuZXN0ZWQgdmlld3MuXG4gICAqXG4gICAqIC0gSWYgYSBzaW5nbGUgdGFwIG9uIHRoZSBzY3JvbGwgdmlldyB0cmlnZ2VycyBhbiBhY3Rpb24gc3VjaCBhc1xuICAgKiAgIHJlY2VudGVyaW5nIGEgbWFwIHN0eWxlIHZpZXcgeWV0IHdhbnRzIHRvIGdpdmUgcHJpb3JpdHkgdG8gaW50ZXJhY3Rpb25cbiAgICogICB2aWV3cyBpbnNpZGUgKHN1Y2ggYXMgZHJvcHBlZCBwaW5zIG9yIGxhYmVscyksIHRoZW4gd2Ugd291bGQgcmV0dXJuIHRydWVcbiAgICogICBmcm9tIHRoaXMgbWV0aG9kIHdoZW4gdGhlcmUgaXMgYSBzaW5nbGUgdG91Y2guXG4gICAqXG4gICAqIC0gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgY2FzZSwgaWYgYSB0d28gZmluZ2VyIFwidGFwXCIgc2hvdWxkIHRyaWdnZXIgYVxuICAgKiAgIHpvb20sIHdlIHdvdWxkIGNoZWNrIHRoZSBgdG91Y2hlc2AgY291bnQsIGFuZCBpZiBgPj0gMmAsIHdlIHdvdWxkIHJldHVyblxuICAgKiAgIHRydWUuXG4gICAqXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTdGFydFNob3VsZFNldFJlc3BvbmRlcjogZnVuY3Rpb24oXG4gICAgZTogUHJlc3NFdmVudCxcbiAgKTogYm9vbGVhbiB7XG4gICAgLy8gQWxsb3cgYW55IGV2ZW50IHRvdWNoIHBhc3MgdGhyb3VnaCBpZiB0aGUgZGVmYXVsdCBwYW4gcmVzcG9uZGVyIGlzIGRpc2FibGVkXG4gICAgaWYgKHRoaXMucHJvcHMuZGlzYWJsZVNjcm9sbFZpZXdQYW5SZXNwb25kZXIgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ID0gVGV4dElucHV0U3RhdGUuY3VycmVudGx5Rm9jdXNlZEZpZWxkKCk7XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLnByb3BzLmtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09ICdoYW5kbGVkJyAmJlxuICAgICAgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAhPSBudWxsICYmXG4gICAgICBSZWFjdE5hdGl2ZS5maW5kTm9kZUhhbmRsZShlLnRhcmdldCkgIT09IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXRcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZXJlIGFyZSB0aW1lcyB3aGVuIHRoZSBzY3JvbGwgdmlldyB3YW50cyB0byBiZWNvbWUgdGhlIHJlc3BvbmRlclxuICAgKiAobWVhbmluZyByZXNwb25kIHRvIHRoZSBuZXh0IGltbWVkaWF0ZSBgdG91Y2hTdGFydC90b3VjaEVuZGApLCBpbiBhIHdheVxuICAgKiB0aGF0ICpkb2Vzbid0KiBnaXZlIHByaW9yaXR5IHRvIG5lc3RlZCB2aWV3cyAoaGVuY2UgdGhlIGNhcHR1cmUgcGhhc2UpOlxuICAgKlxuICAgKiAtIEN1cnJlbnRseSBhbmltYXRpbmcuXG4gICAqIC0gVGFwcGluZyBhbnl3aGVyZSB0aGF0IGlzIG5vdCBhIHRleHQgaW5wdXQsIHdoaWxlIHRoZSBrZXlib2FyZCBpc1xuICAgKiAgIHVwICh3aGljaCBzaG91bGQgZGlzbWlzcyB0aGUga2V5Ym9hcmQpLlxuICAgKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZWAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmU6IGZ1bmN0aW9uKFxuICAgIGU6IFByZXNzRXZlbnQsXG4gICk6IGJvb2xlYW4ge1xuICAgIC8vIFRoZSBzY3JvbGwgdmlldyBzaG91bGQgcmVjZWl2ZSB0YXBzIGluc3RlYWQgb2YgaXRzIGRlc2NlbmRhbnRzIGlmOlxuICAgIC8vICogaXQgaXMgYWxyZWFkeSBhbmltYXRpbmcvZGVjZWxlcmF0aW5nXG4gICAgaWYgKHRoaXMuc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmcoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gQWxsb3cgYW55IGV2ZW50IHRvdWNoIHBhc3MgdGhyb3VnaCBpZiB0aGUgZGVmYXVsdCBwYW4gcmVzcG9uZGVyIGlzIGRpc2FibGVkXG4gICAgaWYgKHRoaXMucHJvcHMuZGlzYWJsZVNjcm9sbFZpZXdQYW5SZXNwb25kZXIgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyAqIHRoZSBrZXlib2FyZCBpcyB1cCwga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyBpcyAnbmV2ZXInICh0aGUgZGVmYXVsdCksXG4gICAgLy8gYW5kIGEgbmV3IHRvdWNoIHN0YXJ0cyB3aXRoIGEgbm9uLXRleHRpbnB1dCB0YXJnZXQgKGluIHdoaWNoIGNhc2UgdGhlXG4gICAgLy8gZmlyc3QgdGFwIHNob3VsZCBiZSBzZW50IHRvIHRoZSBzY3JvbGwgdmlldyBhbmQgZGlzbWlzcyB0aGUga2V5Ym9hcmQsXG4gICAgLy8gdGhlbiB0aGUgc2Vjb25kIHRhcCBnb2VzIHRvIHRoZSBhY3R1YWwgaW50ZXJpb3IgdmlldylcbiAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ID0gVGV4dElucHV0U3RhdGUuY3VycmVudGx5Rm9jdXNlZEZpZWxkKCk7XG4gICAgY29uc3Qge2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHN9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBrZXlib2FyZE5ldmVyUGVyc2lzdFRhcHMgPVxuICAgICAgIWtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgfHwga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA9PT0gJ25ldmVyJztcblxuICAgIGNvbnN0IHJlYWN0VGFnID0gUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUoZS50YXJnZXQpO1xuICAgIGlmIChcbiAgICAgIGtleWJvYXJkTmV2ZXJQZXJzaXN0VGFwcyAmJlxuICAgICAgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAhPSBudWxsICYmXG4gICAgICByZWFjdFRhZyAmJlxuICAgICAgIVRleHRJbnB1dFN0YXRlLmlzVGV4dElucHV0KHJlYWN0VGFnKVxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblJlc3BvbmRlclJlamVjdGAgZXZlbnQuXG4gICAqXG4gICAqIFNvbWUgb3RoZXIgZWxlbWVudCBpcyBub3QgeWllbGRpbmcgaXRzIHJvbGUgYXMgcmVzcG9uZGVyLiBOb3JtYWxseSwgd2UnZFxuICAgKiBqdXN0IGRpc2FibGUgdGhlIGBVSVNjcm9sbFZpZXdgLCBidXQgYSB0b3VjaCBoYXMgYWxyZWFkeSBiZWdhbiBvbiBpdCwgdGhlXG4gICAqIGBVSVNjcm9sbFZpZXdgIHdpbGwgbm90IGFjY2VwdCBiZWluZyBkaXNhYmxlZCBhZnRlciB0aGF0LiBUaGUgZWFzaWVzdFxuICAgKiBzb2x1dGlvbiBmb3Igbm93IGlzIHRvIGFjY2VwdCB0aGUgbGltaXRhdGlvbiBvZiBkaXNhbGxvd2luZyB0aGlzXG4gICAqIGFsdG9nZXRoZXIuIFRvIGltcHJvdmUgdGhpcywgZmluZCBhIHdheSB0byBkaXNhYmxlIHRoZSBgVUlTY3JvbGxWaWV3YCBhZnRlclxuICAgKiBhIHRvdWNoIGhhcyBhbHJlYWR5IHN0YXJ0ZWQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWplY3Q6IGZ1bmN0aW9uKCkge30sXG5cbiAgLyoqXG4gICAqIFdlIHdpbGwgYWxsb3cgdGhlIHNjcm9sbCB2aWV3IHRvIGdpdmUgdXAgaXRzIGxvY2sgaWZmIGl0IGFjcXVpcmVkIHRoZSBsb2NrXG4gICAqIGR1cmluZyBhbiBhbmltYXRpb24uIFRoaXMgaXMgYSB2ZXJ5IHVzZWZ1bCBkZWZhdWx0IHRoYXQgaGFwcGVucyB0byBzYXRpc2Z5XG4gICAqIG1hbnkgY29tbW9uIHVzZXIgZXhwZXJpZW5jZXMuXG4gICAqXG4gICAqIC0gU3RvcCBhIHNjcm9sbCBvbiB0aGUgbGVmdCBlZGdlLCB0aGVuIHR1cm4gdGhhdCBpbnRvIGFuIG91dGVyIHZpZXcnc1xuICAgKiAgIGJhY2tzd2lwZS5cbiAgICogLSBTdG9wIGEgc2Nyb2xsIG1pZC1ib3VuY2UgYXQgdGhlIHRvcCwgY29udGludWUgcHVsbGluZyB0byBoYXZlIHRoZSBvdXRlclxuICAgKiAgIHZpZXcgZGlzbWlzcy5cbiAgICogLSBIb3dldmVyLCB3aXRob3V0IGNhdGNoaW5nIHRoZSBzY3JvbGwgdmlldyBtaWQtYm91bmNlICh3aGlsZSBpdCBpc1xuICAgKiAgIG1vdGlvbmxlc3MpLCBpZiB5b3UgZHJhZyBmYXIgZW5vdWdoIGZvciB0aGUgc2Nyb2xsIHZpZXcgdG8gYmVjb21lXG4gICAqICAgcmVzcG9uZGVyIChhbmQgdGhlcmVmb3JlIGRyYWcgdGhlIHNjcm9sbCB2aWV3IGEgYml0KSwgYW55IGJhY2tzd2lwZVxuICAgKiAgIG5hdmlnYXRpb24gb2YgYSBzd2lwZSBnZXN0dXJlIGhpZ2hlciBpbiB0aGUgdmlldyBoaWVyYXJjaHksIHNob3VsZCBiZVxuICAgKiAgIHJlamVjdGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVGVybWluYXRpb25SZXF1ZXN0OiBmdW5jdGlvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblRvdWNoRW5kYCBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIHtQcmVzc0V2ZW50fSBlIEV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hFbmQ6IGZ1bmN0aW9uKGU6IFByZXNzRXZlbnQpIHtcbiAgICBjb25zdCBuYXRpdmVFdmVudCA9IGUubmF0aXZlRXZlbnQ7XG4gICAgdGhpcy5zdGF0ZS5pc1RvdWNoaW5nID0gbmF0aXZlRXZlbnQudG91Y2hlcy5sZW5ndGggIT09IDA7XG4gICAgdGhpcy5wcm9wcy5vblRvdWNoRW5kICYmIHRoaXMucHJvcHMub25Ub3VjaEVuZChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaENhbmNlbGAgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJlc3NFdmVudH0gZSBFdmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoQ2FuY2VsOiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5pc1RvdWNoaW5nID0gZmFsc2U7XG4gICAgdGhpcy5wcm9wcy5vblRvdWNoQ2FuY2VsICYmIHRoaXMucHJvcHMub25Ub3VjaENhbmNlbChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJSZWxlYXNlYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlclJlbGVhc2U6IGZ1bmN0aW9uKGU6IFByZXNzRXZlbnQpIHtcbiAgICB0aGlzLnByb3BzLm9uUmVzcG9uZGVyUmVsZWFzZSAmJiB0aGlzLnByb3BzLm9uUmVzcG9uZGVyUmVsZWFzZShlKTtcblxuICAgIC8vIEJ5IGRlZmF1bHQgc2Nyb2xsIHZpZXdzIHdpbGwgdW5mb2N1cyBhIHRleHRGaWVsZFxuICAgIC8vIGlmIGFub3RoZXIgdG91Y2ggb2NjdXJzIG91dHNpZGUgb2YgaXRcbiAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ID0gVGV4dElucHV0U3RhdGUuY3VycmVudGx5Rm9jdXNlZEZpZWxkKCk7XG4gICAgaWYgKFxuICAgICAgdGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSB0cnVlICYmXG4gICAgICB0aGlzLnByb3BzLmtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgIT09ICdhbHdheXMnICYmXG4gICAgICBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ICE9IG51bGwgJiZcbiAgICAgIFJlYWN0TmF0aXZlLmZpbmROb2RlSGFuZGxlKGUudGFyZ2V0KSAhPT0gY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAmJlxuICAgICAgIXRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyICYmXG4gICAgICAhdGhpcy5zdGF0ZS5iZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZ1xuICAgICkge1xuICAgICAgdGhpcy5wcm9wcy5vblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkICYmXG4gICAgICAgIHRoaXMucHJvcHMub25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZChlKTtcbiAgICAgIFRleHRJbnB1dFN0YXRlLmJsdXJUZXh0SW5wdXQoY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCk7XG4gICAgfVxuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbDogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICAodGhpczogYW55KS5zdGF0ZS5vYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIgPSB0cnVlO1xuICAgICh0aGlzOiBhbnkpLnByb3BzLm9uU2Nyb2xsICYmICh0aGlzOiBhbnkpLnByb3BzLm9uU2Nyb2xsKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblJlc3BvbmRlckdyYW50YCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlckdyYW50OiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIHRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyID0gZmFsc2U7XG4gICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlckdyYW50ICYmIHRoaXMucHJvcHMub25SZXNwb25kZXJHcmFudChlKTtcbiAgICB0aGlzLnN0YXRlLmJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nID0gdGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBVbmZvcnR1bmF0ZWx5LCBgb25TY3JvbGxCZWdpbkRyYWdgIGFsc28gZmlyZXMgd2hlbiAqc3RvcHBpbmcqIHRoZSBzY3JvbGxcbiAgICogYW5pbWF0aW9uLCBhbmQgdGhlcmUncyBub3QgYW4gZWFzeSB3YXkgdG8gZGlzdGluZ3Vpc2ggYSBkcmFnIHZzLiBzdG9wcGluZ1xuICAgKiBtb21lbnR1bS5cbiAgICpcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TY3JvbGxCZWdpbkRyYWdgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsQmVnaW5EcmFnOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIEZyYW1lUmF0ZUxvZ2dlci5iZWdpblNjcm9sbCgpOyAvLyBUT0RPOiB0cmFjayBhbGwgc2Nyb2xscyBhZnRlciBpbXBsZW1lbnRpbmcgb25TY3JvbGxFbmRBbmltYXRpb25cbiAgICB0aGlzLnByb3BzLm9uU2Nyb2xsQmVnaW5EcmFnICYmIHRoaXMucHJvcHMub25TY3JvbGxCZWdpbkRyYWcoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsRW5kRHJhZ2AgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxFbmREcmFnOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIGNvbnN0IHt2ZWxvY2l0eX0gPSBlLm5hdGl2ZUV2ZW50O1xuICAgIC8vIC0gSWYgd2UgYXJlIGFuaW1hdGluZywgdGhlbiB0aGlzIGlzIGEgXCJkcmFnXCIgdGhhdCBpcyBzdG9wcGluZyB0aGUgc2Nyb2xsdmlldyBhbmQgbW9tZW50dW0gZW5kXG4gICAgLy8gICB3aWxsIGZpcmUuXG4gICAgLy8gLSBJZiB2ZWxvY2l0eSBpcyBub24temVybywgdGhlbiB0aGUgaW50ZXJhY3Rpb24gd2lsbCBzdG9wIHdoZW4gbW9tZW50dW0gc2Nyb2xsIGVuZHMgb3JcbiAgICAvLyAgIGFub3RoZXIgZHJhZyBzdGFydHMgYW5kIGVuZHMuXG4gICAgLy8gLSBJZiB3ZSBkb24ndCBnZXQgdmVsb2NpdHksIGJldHRlciB0byBzdG9wIHRoZSBpbnRlcmFjdGlvbiB0d2ljZSB0aGFuIG5vdCBzdG9wIGl0LlxuICAgIGlmIChcbiAgICAgICF0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkgJiZcbiAgICAgICghdmVsb2NpdHkgfHwgKHZlbG9jaXR5LnggPT09IDAgJiYgdmVsb2NpdHkueSA9PT0gMCkpXG4gICAgKSB7XG4gICAgICBGcmFtZVJhdGVMb2dnZXIuZW5kU2Nyb2xsKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnICYmIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxCZWdpbjogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4gJiYgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4oZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uTW9tZW50dW1TY3JvbGxFbmRgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxFbmQ6IGZ1bmN0aW9uKGU6IFNjcm9sbEV2ZW50KSB7XG4gICAgRnJhbWVSYXRlTG9nZ2VyLmVuZFNjcm9sbCgpO1xuICAgIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsRW5kICYmIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEVuZChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaFN0YXJ0YCBldmVudC5cbiAgICpcbiAgICogU2luY2Ugd2Uga25vdyB0aGF0IHRoZSBgU2ltcGxlRXZlbnRQbHVnaW5gIG9jY3VycyBsYXRlciBpbiB0aGUgcGx1Z2luXG4gICAqIG9yZGVyLCBhZnRlciBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLCB3ZSBjYW4gZGV0ZWN0IHRoYXQgd2Ugd2VyZSAqbm90KlxuICAgKiBwZXJtaXR0ZWQgdG8gYmUgdGhlIHJlc3BvbmRlciAocHJlc3VtYWJseSBiZWNhdXNlIGEgY29udGFpbmVkIHZpZXcgYmVjYW1lXG4gICAqIHJlc3BvbmRlcikuIFRoZSBgb25SZXNwb25kZXJSZWplY3RgIHdvbid0IGZpcmUgaW4gdGhhdCBjYXNlIC0gaXQgb25seVxuICAgKiBmaXJlcyB3aGVuIGEgKmN1cnJlbnQqIHJlc3BvbmRlciByZWplY3RzIG91ciByZXF1ZXN0LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgVG91Y2ggU3RhcnQgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaFN0YXJ0OiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5pc1RvdWNoaW5nID0gdHJ1ZTtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hTdGFydCAmJiB0aGlzLnByb3BzLm9uVG91Y2hTdGFydChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaE1vdmVgIGV2ZW50LlxuICAgKlxuICAgKiBTaW5jZSB3ZSBrbm93IHRoYXQgdGhlIGBTaW1wbGVFdmVudFBsdWdpbmAgb2NjdXJzIGxhdGVyIGluIHRoZSBwbHVnaW5cbiAgICogb3JkZXIsIGFmdGVyIGBSZXNwb25kZXJFdmVudFBsdWdpbmAsIHdlIGNhbiBkZXRlY3QgdGhhdCB3ZSB3ZXJlICpub3QqXG4gICAqIHBlcm1pdHRlZCB0byBiZSB0aGUgcmVzcG9uZGVyIChwcmVzdW1hYmx5IGJlY2F1c2UgYSBjb250YWluZWQgdmlldyBiZWNhbWVcbiAgICogcmVzcG9uZGVyKS4gVGhlIGBvblJlc3BvbmRlclJlamVjdGAgd29uJ3QgZmlyZSBpbiB0aGF0IGNhc2UgLSBpdCBvbmx5XG4gICAqIGZpcmVzIHdoZW4gYSAqY3VycmVudCogcmVzcG9uZGVyIHJlamVjdHMgb3VyIHJlcXVlc3QuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJlc3NFdmVudH0gZSBUb3VjaCBTdGFydCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoTW92ZTogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMucHJvcHMub25Ub3VjaE1vdmUgJiYgdGhpcy5wcm9wcy5vblRvdWNoTW92ZShlKTtcbiAgfSxcblxuICAvKipcbiAgICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIHRoaXMgY2xhc3MgdGhhdCBsZXRzIHVzIHF1aWNrbHkgZGV0ZXJtaW5lIGlmIHRoZVxuICAgKiB2aWV3IGlzIGN1cnJlbnRseSBhbmltYXRpbmcuIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCB0byBrbm93IHdoZW5cbiAgICogYSB0b3VjaCBoYXMganVzdCBzdGFydGVkIG9yIGVuZGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmc6IGZ1bmN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgY29uc3QgdGltZVNpbmNlTGFzdE1vbWVudHVtU2Nyb2xsRW5kID1cbiAgICAgIG5vdyAtIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZTtcbiAgICBjb25zdCBpc0FuaW1hdGluZyA9XG4gICAgICB0aW1lU2luY2VMYXN0TW9tZW50dW1TY3JvbGxFbmQgPCBJU19BTklNQVRJTkdfVE9VQ0hfU1RBUlRfVEhSRVNIT0xEX01TIHx8XG4gICAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUgPFxuICAgICAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTtcbiAgICByZXR1cm4gaXNBbmltYXRpbmc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG5vZGUgdGhhdCByZXByZXNlbnRzIG5hdGl2ZSB2aWV3IHRoYXQgY2FuIGJlIHNjcm9sbGVkLlxuICAgKiBDb21wb25lbnRzIGNhbiBwYXNzIHdoYXQgbm9kZSB0byB1c2UgYnkgZGVmaW5pbmcgYSBgZ2V0U2Nyb2xsYWJsZU5vZGVgXG4gICAqIGZ1bmN0aW9uIG90aGVyd2lzZSBgdGhpc2AgaXMgdXNlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlOiBmdW5jdGlvbigpOiA/bnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGxhYmxlTm9kZVxuICAgICAgPyB0aGlzLmdldFNjcm9sbGFibGVOb2RlKClcbiAgICAgIDogUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUodGhpcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIHRvIHNjcm9sbCB0byBhIHNwZWNpZmljIHBvaW50IGluIHRoZSBTY3JvbGxWaWV3LlxuICAgKiBUaGlzIGlzIGN1cnJlbnRseSB1c2VkIHRvIGhlbHAgZm9jdXMgY2hpbGQgVGV4dFZpZXdzLCBidXQgY2FuIGFsc29cbiAgICogYmUgdXNlZCB0byBxdWlja2x5IHNjcm9sbCB0byBhbnkgZWxlbWVudCB3ZSB3YW50IHRvIGZvY3VzLiBTeW50YXg6XG4gICAqXG4gICAqIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyhvcHRpb25zOiB7eDogbnVtYmVyID0gMDsgeTogbnVtYmVyID0gMDsgYW5pbWF0ZWQ6IGJvb2xlYW4gPSB0cnVlfSlgXG4gICAqXG4gICAqIE5vdGU6IFRoZSB3ZWlyZCBhcmd1bWVudCBzaWduYXR1cmUgaXMgZHVlIHRvIHRoZSBmYWN0IHRoYXQsIGZvciBoaXN0b3JpY2FsIHJlYXNvbnMsXG4gICAqIHRoZSBmdW5jdGlvbiBhbHNvIGFjY2VwdHMgc2VwYXJhdGUgYXJndW1lbnRzIGFzIGFzIGFsdGVybmF0aXZlIHRvIHRoZSBvcHRpb25zIG9iamVjdC5cbiAgICogVGhpcyBpcyBkZXByZWNhdGVkIGR1ZSB0byBhbWJpZ3VpdHkgKHkgYmVmb3JlIHgpLCBhbmQgU0hPVUxEIE5PVCBCRSBVU0VELlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG86IGZ1bmN0aW9uKFxuICAgIHg/OlxuICAgICAgfCBudW1iZXJcbiAgICAgIHwge1xuICAgICAgICAgIHg/OiBudW1iZXIsXG4gICAgICAgICAgeT86IG51bWJlcixcbiAgICAgICAgICBhbmltYXRlZD86IGJvb2xlYW4sXG4gICAgICAgICAgLi4uXG4gICAgICAgIH0sXG4gICAgeT86IG51bWJlcixcbiAgICBhbmltYXRlZD86IGJvb2xlYW4sXG4gICkge1xuICAgIGlmICh0eXBlb2YgeCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ2BzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh4LCB5LCBhbmltYXRlZClgIGlzIGRlcHJlY2F0ZWQuIFVzZSBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oe3g6IDUsIHk6IDUsIGFuaW1hdGVkOiB0cnVlfSlgIGluc3RlYWQuJyxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICh7eCwgeSwgYW5pbWF0ZWR9ID0geCB8fCB7fSk7XG4gICAgfVxuXG4gICAgY29uc3QgdGhhdDogUmVhY3QuRWxlbWVudFJlZjxTY3JvbGxWaWV3PiA9ICh0aGlzOiBhbnkpO1xuICAgIGludmFyaWFudChcbiAgICAgIHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwsXG4gICAgICAnRXhwZWN0ZWQgc2Nyb2xsVG8gdG8gYmUgY2FsbGVkIG9uIGEgc2Nyb2xsVmlld1JlZi4gSWYgdGhpcyBleGNlcHRpb24gb2NjdXJzIGl0IGlzIGxpa2VseSBhIGJ1ZyBpbiBSZWFjdCBOYXRpdmUnLFxuICAgICk7XG4gICAgY29uc3QgbmF0aXZlU2Nyb2xsUmVmID0gdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYoKTtcbiAgICBpZiAobmF0aXZlU2Nyb2xsUmVmID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgQ29tbWFuZHMuc2Nyb2xsVG8obmF0aXZlU2Nyb2xsUmVmLCB4IHx8IDAsIHkgfHwgMCwgYW5pbWF0ZWQgIT09IGZhbHNlKTtcbiAgfSxcblxuICAvKipcbiAgICogU2Nyb2xscyB0byB0aGUgZW5kIG9mIHRoZSBTY3JvbGxWaWV3LCBlaXRoZXIgaW1tZWRpYXRlbHkgb3Igd2l0aCBhIHNtb290aFxuICAgKiBhbmltYXRpb24uXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqXG4gICAqIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZCh7YW5pbWF0ZWQ6IHRydWV9KWBcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kOiBmdW5jdGlvbihvcHRpb25zPzoge2FuaW1hdGVkPzogYm9vbGVhbiwgLi4ufSkge1xuICAgIC8vIERlZmF1bHQgdG8gdHJ1ZVxuICAgIGNvbnN0IGFuaW1hdGVkID0gKG9wdGlvbnMgJiYgb3B0aW9ucy5hbmltYXRlZCkgIT09IGZhbHNlO1xuXG4gICAgY29uc3QgdGhhdDogUmVhY3QuRWxlbWVudFJlZjxTY3JvbGxWaWV3PiA9ICh0aGlzOiBhbnkpO1xuICAgIGludmFyaWFudChcbiAgICAgIHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwsXG4gICAgICAnRXhwZWN0ZWQgc2Nyb2xsVG9FbmQgdG8gYmUgY2FsbGVkIG9uIGEgc2Nyb2xsVmlld1JlZi4gSWYgdGhpcyBleGNlcHRpb24gb2NjdXJzIGl0IGlzIGxpa2VseSBhIGJ1ZyBpbiBSZWFjdCBOYXRpdmUnLFxuICAgICk7XG4gICAgY29uc3QgbmF0aXZlU2Nyb2xsUmVmID0gdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYoKTtcbiAgICBpZiAobmF0aXZlU2Nyb2xsUmVmID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBDb21tYW5kcy5zY3JvbGxUb0VuZChuYXRpdmVTY3JvbGxSZWYsIGFuaW1hdGVkKTtcbiAgfSxcblxuICAvKipcbiAgICogQSBoZWxwZXIgZnVuY3Rpb24gdG8gem9vbSB0byBhIHNwZWNpZmljIHJlY3QgaW4gdGhlIHNjcm9sbHZpZXcuIFRoZSBhcmd1bWVudCBoYXMgdGhlIHNoYXBlXG4gICAqIHt4OiBudW1iZXI7IHk6IG51bWJlcjsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXI7IGFuaW1hdGVkOiBib29sZWFuID0gdHJ1ZX1cbiAgICpcbiAgICogQHBsYXRmb3JtIGlvc1xuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyWm9vbVRvOiBmdW5jdGlvbihcbiAgICByZWN0OiB7fFxuICAgICAgeDogbnVtYmVyLFxuICAgICAgeTogbnVtYmVyLFxuICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgIGhlaWdodDogbnVtYmVyLFxuICAgICAgYW5pbWF0ZWQ/OiBib29sZWFuLFxuICAgIHx9LFxuICAgIGFuaW1hdGVkPzogYm9vbGVhbiwgLy8gZGVwcmVjYXRlZCwgcHV0IHRoaXMgaW5zaWRlIHRoZSByZWN0IGFyZ3VtZW50IGluc3RlYWRcbiAgKSB7XG4gICAgaW52YXJpYW50KFBsYXRmb3JtLk9TID09PSAnaW9zJywgJ3pvb21Ub1JlY3QgaXMgbm90IGltcGxlbWVudGVkJyk7XG4gICAgaWYgKCdhbmltYXRlZCcgaW4gcmVjdCkge1xuICAgICAgYW5pbWF0ZWQgPSByZWN0LmFuaW1hdGVkO1xuICAgICAgZGVsZXRlIHJlY3QuYW5pbWF0ZWQ7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgYW5pbWF0ZWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdgc2Nyb2xsUmVzcG9uZGVyWm9vbVRvYCBgYW5pbWF0ZWRgIGFyZ3VtZW50IGlzIGRlcHJlY2F0ZWQuIFVzZSBgb3B0aW9ucy5hbmltYXRlZGAgaW5zdGVhZCcsXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHRoYXQ6IFJlYWN0LkVsZW1lbnRSZWY8U2Nyb2xsVmlldz4gPSB0aGlzO1xuICAgIGludmFyaWFudChcbiAgICAgIHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwsXG4gICAgICAnRXhwZWN0ZWQgem9vbVRvUmVjdCB0byBiZSBjYWxsZWQgb24gYSBzY3JvbGxWaWV3UmVmLiBJZiB0aGlzIGV4Y2VwdGlvbiBvY2N1cnMgaXQgaXMgbGlrZWx5IGEgYnVnIGluIFJlYWN0IE5hdGl2ZScsXG4gICAgKTtcbiAgICBjb25zdCBuYXRpdmVTY3JvbGxSZWYgPSB0aGF0LmdldE5hdGl2ZVNjcm9sbFJlZigpO1xuICAgIGlmIChuYXRpdmVTY3JvbGxSZWYgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBDb21tYW5kcy56b29tVG9SZWN0KG5hdGl2ZVNjcm9sbFJlZiwgcmVjdCwgYW5pbWF0ZWQgIT09IGZhbHNlKTtcbiAgfSxcblxuICAvKipcbiAgICogRGlzcGxheXMgdGhlIHNjcm9sbCBpbmRpY2F0b3JzIG1vbWVudGFyaWx5LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyRmxhc2hTY3JvbGxJbmRpY2F0b3JzOiBmdW5jdGlvbigpIHtcbiAgICBjb25zdCB0aGF0OiBSZWFjdC5FbGVtZW50UmVmPFNjcm9sbFZpZXc+ID0gKHRoaXM6IGFueSk7XG4gICAgaW52YXJpYW50KFxuICAgICAgdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYgIT0gbnVsbCxcbiAgICAgICdFeHBlY3RlZCBmbGFzaFNjcm9sbEluZGljYXRvcnMgdG8gYmUgY2FsbGVkIG9uIGEgc2Nyb2xsVmlld1JlZi4gSWYgdGhpcyBleGNlcHRpb24gb2NjdXJzIGl0IGlzIGxpa2VseSBhIGJ1ZyBpbiBSZWFjdCBOYXRpdmUnLFxuICAgICk7XG4gICAgY29uc3QgbmF0aXZlU2Nyb2xsUmVmID0gdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYoKTtcbiAgICBpZiAobmF0aXZlU2Nyb2xsUmVmID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgQ29tbWFuZHMuZmxhc2hTY3JvbGxJbmRpY2F0b3JzKG5hdGl2ZVNjcm9sbFJlZik7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIGFzIHRoZSBjYWxsYmFjayB0byBvbkZvY3VzIGluIGEgVGV4dElucHV0cydcbiAgICogcGFyZW50IHZpZXcuIE5vdGUgdGhhdCBhbnkgbW9kdWxlIHVzaW5nIHRoaXMgbWl4aW4gbmVlZHMgdG8gcmV0dXJuXG4gICAqIHRoZSBwYXJlbnQgdmlldydzIHJlZiBpbiBnZXRTY3JvbGxWaWV3UmVmKCkgaW4gb3JkZXIgdG8gdXNlIHRoaXMgbWV0aG9kLlxuICAgKiBAcGFyYW0ge251bWJlcn0gbm9kZUhhbmRsZSBUaGUgVGV4dElucHV0IG5vZGUgaGFuZGxlXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBhZGRpdGlvbmFsT2Zmc2V0IFRoZSBzY3JvbGwgdmlldydzIGJvdHRvbSBcImNvbnRlbnRJbnNldFwiLlxuICAgKiAgICAgICAgRGVmYXVsdCBpcyAwLlxuICAgKiBAcGFyYW0ge2Jvb2x9IHByZXZlbnROZWdhdGl2ZVNjcm9sbGluZyBXaGV0aGVyIHRvIGFsbG93IHB1bGxpbmcgdGhlIGNvbnRlbnRcbiAgICogICAgICAgIGRvd24gdG8gbWFrZSBpdCBtZWV0IHRoZSBrZXlib2FyZCdzIHRvcC4gRGVmYXVsdCBpcyBmYWxzZS5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbE5hdGl2ZUhhbmRsZVRvS2V5Ym9hcmQ6IGZ1bmN0aW9uPFQ+KFxuICAgIG5vZGVIYW5kbGU6XG4gICAgICB8IG51bWJlclxuICAgICAgfCBSZWFjdC5FbGVtZW50UmVmPEhvc3RDb21wb25lbnQ8VD4+XG4gICAgICB8IFJlYWN0LkVsZW1lbnRSZWY8Q2xhc3M8UmVhY3ROYXRpdmUuTmF0aXZlQ29tcG9uZW50PFQ+Pj4sXG4gICAgYWRkaXRpb25hbE9mZnNldD86IG51bWJlcixcbiAgICBwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQ/OiBib29sZWFuLFxuICApIHtcbiAgICB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQgPSBhZGRpdGlvbmFsT2Zmc2V0IHx8IDA7XG4gICAgdGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQgPSAhIXByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldDtcblxuICAgIGlmICh0eXBlb2Ygbm9kZUhhbmRsZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIFVJTWFuYWdlci5tZWFzdXJlTGF5b3V0KFxuICAgICAgICBub2RlSGFuZGxlLFxuICAgICAgICBSZWFjdE5hdGl2ZS5maW5kTm9kZUhhbmRsZSh0aGlzLmdldElubmVyVmlld05vZGUoKSksXG4gICAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyVGV4dElucHV0Rm9jdXNFcnJvcixcbiAgICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaW5uZXJSZWYgPSB0aGlzLmdldElubmVyVmlld1JlZigpO1xuXG4gICAgICBpZiAoaW5uZXJSZWYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG5vZGVIYW5kbGUubWVhc3VyZUxheW91dChcbiAgICAgICAgaW5uZXJSZWYsXG4gICAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVySW5wdXRNZWFzdXJlQW5kU2Nyb2xsVG9LZXlib2FyZCxcbiAgICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yLFxuICAgICAgKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZSBjYWxjdWxhdGlvbnMgcGVyZm9ybWVkIGhlcmUgYXNzdW1lIHRoZSBzY3JvbGwgdmlldyB0YWtlcyB1cCB0aGUgZW50aXJlXG4gICAqIHNjcmVlbiAtIGV2ZW4gaWYgaGFzIHNvbWUgY29udGVudCBpbnNldC4gV2UgdGhlbiBtZWFzdXJlIHRoZSBvZmZzZXRzIG9mIHRoZVxuICAgKiBrZXlib2FyZCwgYW5kIGNvbXBlbnNhdGUgYm90aCBmb3IgdGhlIHNjcm9sbCB2aWV3J3MgXCJjb250ZW50SW5zZXRcIi5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGxlZnQgUG9zaXRpb24gb2YgaW5wdXQgdy5yLnQuIHRhYmxlIHZpZXcuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0b3AgUG9zaXRpb24gb2YgaW5wdXQgdy5yLnQuIHRhYmxlIHZpZXcuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCBXaWR0aCBvZiB0aGUgdGV4dCBpbnB1dC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCBIZWlnaHQgb2YgdGhlIHRleHQgaW5wdXQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkOiBmdW5jdGlvbihcbiAgICBsZWZ0OiBudW1iZXIsXG4gICAgdG9wOiBudW1iZXIsXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgKSB7XG4gICAgbGV0IGtleWJvYXJkU2NyZWVuWSA9IERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKS5oZWlnaHQ7XG4gICAgaWYgKHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvKSB7XG4gICAgICBrZXlib2FyZFNjcmVlblkgPSB0aGlzLmtleWJvYXJkV2lsbE9wZW5Uby5lbmRDb29yZGluYXRlcy5zY3JlZW5ZO1xuICAgIH1cbiAgICBsZXQgc2Nyb2xsT2Zmc2V0WSA9XG4gICAgICB0b3AgLSBrZXlib2FyZFNjcmVlblkgKyBoZWlnaHQgKyB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQ7XG5cbiAgICAvLyBCeSBkZWZhdWx0LCB0aGlzIGNhbiBzY3JvbGwgd2l0aCBuZWdhdGl2ZSBvZmZzZXQsIHB1bGxpbmcgdGhlIGNvbnRlbnRcbiAgICAvLyBkb3duIHNvIHRoYXQgdGhlIHRhcmdldCBjb21wb25lbnQncyBib3R0b20gbWVldHMgdGhlIGtleWJvYXJkJ3MgdG9wLlxuICAgIC8vIElmIHJlcXVlc3RlZCBvdGhlcndpc2UsIGNhcCB0aGUgb2Zmc2V0IGF0IDAgbWluaW11bSB0byBhdm9pZCBjb250ZW50XG4gICAgLy8gc2hpZnRpbmcgZG93bi5cbiAgICBpZiAodGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQpIHtcbiAgICAgIHNjcm9sbE9mZnNldFkgPSBNYXRoLm1heCgwLCBzY3JvbGxPZmZzZXRZKTtcbiAgICB9XG4gICAgdGhpcy5zY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh7eDogMCwgeTogc2Nyb2xsT2Zmc2V0WSwgYW5pbWF0ZWQ6IHRydWV9KTtcblxuICAgIHRoaXMuYWRkaXRpb25hbE9mZnNldCA9IDA7XG4gICAgdGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQgPSBmYWxzZTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yOiBmdW5jdGlvbihtc2c6IHN0cmluZykge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1lYXN1cmluZyB0ZXh0IGZpZWxkOiAnLCBtc2cpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBgY29tcG9uZW50V2lsbE1vdW50YCBpcyB0aGUgY2xvc2VzdCB0aGluZyB0byBhICBzdGFuZGFyZCBcImNvbnN0cnVjdG9yXCIgZm9yXG4gICAqIFJlYWN0IGNvbXBvbmVudHMuXG4gICAqXG4gICAqIFRoZSBga2V5Ym9hcmRXaWxsU2hvd2AgaXMgY2FsbGVkIGJlZm9yZSBpbnB1dCBmb2N1cy5cbiAgICovXG4gIFVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHtrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzfSA9ICgodGhpczogYW55KS5wcm9wczogU2Nyb2xsVmlld1Byb3BzKTtcbiAgICBpZiAodHlwZW9mIGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09ICdib29sZWFuJykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgJ2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHM9eyR7XG4gICAgICAgICAga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA9PT0gdHJ1ZSA/ICd0cnVlJyA6ICdmYWxzZSdcbiAgICAgICAgfX0nIGlzIGRlcHJlY2F0ZWQuIGAgK1xuICAgICAgICAgIGBVc2UgJ2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHM9XCIke1xuICAgICAgICAgICAga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA/ICdhbHdheXMnIDogJ25ldmVyJ1xuICAgICAgICAgIH1cIicgaW5zdGVhZGAsXG4gICAgICApO1xuICAgIH1cblxuICAgICh0aGlzOiBhbnkpLmtleWJvYXJkV2lsbE9wZW5UbyA9IG51bGw7XG4gICAgKHRoaXM6IGFueSkuYWRkaXRpb25hbFNjcm9sbE9mZnNldCA9IDA7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsU2hvdyA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgJ2tleWJvYXJkV2lsbFNob3cnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxTaG93LFxuICAgICk7XG5cbiAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxIaWRlID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAna2V5Ym9hcmRXaWxsSGlkZScsXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbEhpZGUsXG4gICAgKTtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3cgPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICdrZXlib2FyZERpZFNob3cnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZFNob3csXG4gICAgKTtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZEhpZGUgPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICdrZXlib2FyZERpZEhpZGUnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZEhpZGUsXG4gICAgKTtcbiAgfSxcblxuICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3cgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsU2hvdy5yZW1vdmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkU2hvdyAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3cucmVtb3ZlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZEhpZGUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlLnJlbW92ZSgpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogV2FybmluZywgdGhpcyBtYXkgYmUgY2FsbGVkIHNldmVyYWwgdGltZXMgZm9yIGEgc2luZ2xlIGtleWJvYXJkIG9wZW5pbmcuXG4gICAqIEl0J3MgYmVzdCB0byBzdG9yZSB0aGUgaW5mb3JtYXRpb24gaW4gdGhpcyBtZXRob2QgYW5kIHRoZW4gdGFrZSBhbnkgYWN0aW9uXG4gICAqIGF0IGEgbGF0ZXIgcG9pbnQgKGVpdGhlciBpbiBga2V5Ym9hcmREaWRTaG93YCBvciBvdGhlcikuXG4gICAqXG4gICAqIEhlcmUncyB0aGUgb3JkZXIgdGhhdCBldmVudHMgb2NjdXIgaW46XG4gICAqIC0gZm9jdXNcbiAgICogLSB3aWxsU2hvdyB7c3RhcnRDb29yZGluYXRlcywgZW5kQ29vcmRpbmF0ZXN9IHNldmVyYWwgdGltZXNcbiAgICogLSBkaWRTaG93IHNldmVyYWwgdGltZXNcbiAgICogLSBibHVyXG4gICAqIC0gd2lsbEhpZGUge3N0YXJ0Q29vcmRpbmF0ZXMsIGVuZENvb3JkaW5hdGVzfSBzZXZlcmFsIHRpbWVzXG4gICAqIC0gZGlkSGlkZSBzZXZlcmFsIHRpbWVzXG4gICAqXG4gICAqIFRoZSBgU2Nyb2xsUmVzcG9uZGVyYCBtb2R1bGUgY2FsbGJhY2tzIGZvciBlYWNoIG9mIHRoZXNlIGV2ZW50cy5cbiAgICogRXZlbiB0aG91Z2ggYW55IHVzZXIgY291bGQgaGF2ZSBlYXNpbHkgbGlzdGVuZWQgdG8ga2V5Ym9hcmQgZXZlbnRzXG4gICAqIHRoZW1zZWx2ZXMsIHVzaW5nIHRoZXNlIGBwcm9wc2AgY2FsbGJhY2tzIGVuc3VyZXMgdGhhdCBvcmRlcmluZyBvZiBldmVudHNcbiAgICogaXMgY29uc2lzdGVudCAtIGFuZCBub3QgZGVwZW5kZW50IG9uIHRoZSBvcmRlciB0aGF0IHRoZSBrZXlib2FyZCBldmVudHMgYXJlXG4gICAqIHN1YnNjcmliZWQgdG8uIFRoaXMgbWF0dGVycyB3aGVuIHRlbGxpbmcgdGhlIHNjcm9sbCB2aWV3IHRvIHNjcm9sbCB0byB3aGVyZVxuICAgKiB0aGUga2V5Ym9hcmQgaXMgaGVhZGVkIC0gdGhlIHNjcm9sbCByZXNwb25kZXIgYmV0dGVyIGhhdmUgYmVlbiBub3RpZmllZCBvZlxuICAgKiB0aGUga2V5Ym9hcmQgZGVzdGluYXRpb24gYmVmb3JlIGJlaW5nIGluc3RydWN0ZWQgdG8gc2Nyb2xsIHRvIHdoZXJlIHRoZVxuICAgKiBrZXlib2FyZCB3aWxsIGJlLiBTdGljayB0byB0aGUgYFNjcm9sbFJlc3BvbmRlcmAgY2FsbGJhY2tzLCBhbmQgZXZlcnl0aGluZ1xuICAgKiB3aWxsIHdvcmsuXG4gICAqXG4gICAqIFdBUk5JTkc6IFRoZXNlIGNhbGxiYWNrcyB3aWxsIGZpcmUgZXZlbiBpZiBhIGtleWJvYXJkIGlzIGRpc3BsYXllZCBpbiBhXG4gICAqIGRpZmZlcmVudCBuYXZpZ2F0aW9uIHBhbmUuIEZpbHRlciBvdXQgdGhlIGV2ZW50cyB0byBkZXRlcm1pbmUgaWYgdGhleSBhcmVcbiAgICogcmVsZXZhbnQgdG8geW91LiAoRm9yIGV4YW1wbGUsIG9ubHkgaWYgeW91IHJlY2VpdmUgdGhlc2UgY2FsbGJhY2tzIGFmdGVyXG4gICAqIHlvdSBoYWQgZXhwbGljaXRseSBmb2N1c2VkIGEgbm9kZSBldGMpLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdzogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gZTtcbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsU2hvdyAmJiB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsU2hvdyhlKTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxIaWRlOiBmdW5jdGlvbihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBudWxsO1xuICAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxIaWRlICYmIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxIaWRlKGUpO1xuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkU2hvdzogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIC8vIFRPRE8oNzY5Mzk2MSk6IFRoZSBldmVudCBmb3IgRGlkU2hvdyBpcyBub3QgYXZhaWxhYmxlIG9uIGlPUyB5ZXQuXG4gICAgLy8gVXNlIHRoZSBvbmUgZnJvbSBXaWxsU2hvdyBhbmQgZG8gbm90IGFzc2lnbi5cbiAgICBpZiAoZSkge1xuICAgICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBlO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRTaG93ICYmIHRoaXMucHJvcHMub25LZXlib2FyZERpZFNob3coZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRIaWRlOiBmdW5jdGlvbihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBudWxsO1xuICAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGUgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkSGlkZShlKTtcbiAgfSxcbn07XG5cbmNvbnN0IFNjcm9sbFJlc3BvbmRlciA9IHtcbiAgTWl4aW46IFNjcm9sbFJlc3BvbmRlck1peGluLFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTY3JvbGxSZXNwb25kZXI7XG4iXX0=